<template>
	<div class="page">
	    <div class="page-content account-area">
			<div class="dz-banner" style="background-image:url(img/banner/bnr-1.jpg); background-repeat:no-repeat; background-size:cover;"></div>
			<div class="dz-banner-height"></div>
			<div class="fixed-content py-30">
				<div class="container">
					<div class="form-elements">
						<form>
							<div class="title-bar mb-20">
								<h3 class="dz-title ma-0">Create your account </h3>
								<a href="/signin/" class="icon-close"><i class="flaticon-cancel"></i></a>
							</div>
							<div class="list mb-0">
								<ul class="row">
									<li class="item-content col-100 item-input item-input-with-value">
										<div class="item-inner">
											<div class="item-input-wrap">
												<input type="email" placeholder="Email" id="demo-username-11" class="form-control"
												@input="inputEmail" value="{{email}}" />
											</div>
										</div>
									</li>
									<!-- <li class="item-content col-50 item-input item-input-with-value">
										<div class="item-inner">
											<div class="item-input-wrap">
												<input type="text" placeholder="Last Name" value="Witwicky" id="demo-username-13" class="form-control"/>
											</div>
										</div>
									</li> -->
									<!-- <li class="item-content col-100 item-input">
										<div class="item-inner">
											<div class="item-input-wrap">
												<input type="email" placeholder="Email Address" value="info@example.com" id="demo-password-13" class="form-control"/>
											</div>
										</div>
									</li> -->
									<li class="item-content col-100 item-input">
										<div class="item-inner">
											<div class="item-input-wrap">
												<input type="text" placeholder="Name" id="demo-password-14" class="form-control"
												@input="inputName" value="{{name}}" />
											</div>
										</div>
									</li>
									<li class="item-content col-100 item-input">
										<div class="item-inner">
											<div class="item-input-wrap">
												<input type="password" placeholder="Password" id="demo-password-14" class="form-control"
												@input="inputPass" value="{{password}}" />
											</div>
										</div>
									</li>
									<li class="item-content col-100 item-input">
										<div class="item-inner">
											<div class="item-input-wrap input-dropdown-wrap">
												<label for="demo-il-14">Apakah anda kepala keluarga?</label>
												<select id="demo-il-14" @change="selectKK" required>
													<option value="true">YA</option>
													<option value="false">TIDAK</option>
												</select>
											</div>
										</div>
									</li>
								</ul>
							</div>
							<div class="list text-center">
								<p class="mt-0 mb-20 fs-14 d-inline-block">By tapping Sign up you accept all <a href="#" class="fw6 tab-link">terms</a> and <a href="#" class="fw6 tab-link">condition</a></p>
							</div>
							<div class="list">
								<a href="#" @click="register" class="button-large button button-fill">Create an account</a></li>
							</div>
						</form>
					</div>
				</div>
			</div>
	    </div>
	</div>
</template>

<script>
	return {
    // Component Data
    data: function () {
      // Must return an object
      return {
        email: null,
				password: null,
				name: null,
				is_leader: "true",
      }
    },
    // Component Methods
    methods: {
      register: function () {
        var self = this;

				self.$app.request({
          method: 'POST',
          url: self.$root.getURL()+'/user',
          data: {
						email: self.email,
						password: self.password,
						name: self.name,
						role: 1,
    				is_active: 0,
						is_leader: self.is_leader == "true" ? 1 : 0,
					},
					// headers: {
					// 	'Access-Control-Allow-Origin': '*',
					// 	'Access-Control-Allow-Headers': 'Origin, X-Requested-With, Content-Type, Accept'
					// },
					contentType: 'application/json',
          success: function(res) {
						const data = JSON.parse(res)

						if(!data.status) {
							self.$app.dialog.alert(data.message || "Error");
							return
						}
            // self.$app.router.navigate('home')
						self.$app.dialog.alert("Registrasi berhasil, namun akun anda belum aktif harap hubungi admin koperasi untuk aktivasi");
						return app.views.main.router.navigate('/signin/');
          },
          error: function(err) {
						let msg = null
						if(err.response){
							msg = JSON.parse(err.response)
						}
            self.$app.dialog.alert(msg.message || "Error");
          }
        })
      },
      inputEmail: function (e) {
        var self = this;
        self.$setState({
          email: e.target.value,
        });
      },
			inputPass: function (e) {
        var self = this;
        self.$setState({
          password: e.target.value,
        });
      },
			inputName: function (e) {
        var self = this;
        self.$setState({
          name: e.target.value,
        });
      },
			selectKK: function (e) {
        let self = this;
        self.$setState({
          is_leader: e.target.value,
        })
      }
    },
	}
</script>
